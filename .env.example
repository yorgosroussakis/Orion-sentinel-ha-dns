# Network Configuration
# =====================
# NODE_NAME: Human-friendly identifier for this node
NODE_NAME=orion-dns

# HOST_IP: The IP address of this node/Pi
HOST_IP=192.168.8.250

# For two-pi-ha mode, set the IP of each Pi:
# PI1_IP=192.168.8.250
# PI2_IP=192.168.8.251

# DNS IPs (for reference/compatibility)
PRIMARY_DNS_IP=192.168.8.250
SECONDARY_DNS_IP=192.168.8.251
UNBOUND_PRIMARY_IP=192.168.8.253
UNBOUND_SECONDARY_IP=192.168.8.254

# VIP_ADDRESS: Virtual IP for HA DNS (should NOT be .0 or .255)
# This IP floats between nodes and is what clients use for DNS
VIP_ADDRESS=192.168.8.249

NETWORK_INTERFACE=eth0
SUBNET=192.168.8.0/24
GATEWAY=192.168.8.1

# Timezone
TZ=Europe/Amsterdam

# ================================================================
# PI-HOLE DNS UPSTREAM CONFIGURATION - PRIVACY POLICY
# ================================================================
#
# ⚠️  CRITICAL PRIVACY WARNING ⚠️
#
# This project ONLY supports the following upstream DNS provider:
#   ✅ Unbound (local recursive resolver) - Maximum privacy
#
# DO NOT USE PUBLIC DNS PROVIDERS - They expose your DNS queries!
#   ❌ Google DNS (8.8.8.8, 8.8.4.4)
#   ❌ Cloudflare DNS (1.1.1.1, 1.0.0.1)
#   ❌ OpenDNS (208.67.222.222, 208.67.220.220)
#   ❌ Quad9 (9.9.9.9, 149.112.112.112)
#   ❌ Any other third-party DNS provider
#
# Using Unbound means DNS queries go directly to authoritative servers,
# eliminating third-party visibility of your browsing history.
#
# See docs/PIHOLE_CONFIGURATION.md for full privacy rationale.
#
# ================================================================

# Pi-hole Configuration
# SECURITY: Generate a strong random password or set your own secure password
# Example: openssl rand -base64 32
PIHOLE_PASSWORD=CHANGE_ME_REQUIRED

# Pi-hole Upstream DNS - ONLY Unbound is supported
# These point to local Unbound resolver(s) for maximum privacy
PIHOLE_DNS1=127.0.0.1#5335
PIHOLE_DNS2=127.0.0.1#5335

WEBPASSWORD=${PIHOLE_PASSWORD}

# Pi-hole Blocklist Profile
# Controls which curated blocklist set is applied during setup
# Options:
#   - standard (default): Balanced ad/malware/tracker blocking (~4-5M domains)
#     Includes: Hagezi Pro++, OISD Big, Hagezi Threat Intelligence
#   - family: Standard + additional family-safe filtering (~5-6M domains)
#     Includes: All standard + Hagezi Multi
#   - paranoid: Maximum protection, may break some sites (~7-8M domains)
#     Includes: All family + Hagezi Ultimate
# See USER_GUIDE.md for detailed information about each profile
PIHOLE_BLOCKLIST_PROFILE=standard

# Grafana
GRAFANA_ADMIN_USER=admin
# SECURITY: Generate a strong random password or set your own secure password
# Example: openssl rand -base64 32
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_REQUIRED

# Signal Notifications (using signal-cli-rest-api)
# Register your phone number with signal-cli first (see SIGNAL_INTEGRATION_GUIDE.md)
SIGNAL_NUMBER=+1234567890  # Your phone number registered with Signal (with country code)
SIGNAL_RECIPIENTS=+1234567890  # Comma-separated list of recipient phone numbers

# Keepalived
# SECURITY: Generate a strong random password or set your own secure password
# Example: openssl rand -base64 20
VRRP_PASSWORD=CHANGE_ME_REQUIRED

# AI-Watchdog
WATCHDOG_CHECK_INTERVAL=30
WATCHDOG_RESTART_THRESHOLD=3
WATCHDOG_ALERT_COOLDOWN=300

# Prometheus
PROMETHEUS_RETENTION=30d

# Docker Networks
OBSERVABILITY_NETWORK=observability_net
DNS_NETWORK=dns_net

# Management Stack (Optional)
NETDATA_CLAIM_TOKEN=
WATCHTOWER_NOTIFICATION_URL=
HOMEPAGE_VAR_HOST_IP=192.168.8.250
HOMEPAGE_VAR_PIHOLE_PRIMARY_IP=192.168.8.251
HOMEPAGE_VAR_PIHOLE_SECONDARY_IP=192.168.8.252
HOMEPAGE_VAR_PIHOLE_API_KEY=
HOMEPAGE_VAR_GRAFANA_USER=admin
HOMEPAGE_VAR_GRAFANA_PASSWORD=${GRAFANA_ADMIN_PASSWORD}
HOMEPAGE_VAR_KUMA_SLUG=
HOMEPAGE_VAR_PORTAINER_KEY=

# Remote Access Configuration (OPTIONAL - Choose one or more)
# ================================================================
# The stack works perfectly WITHOUT remote access!
# Only configure this if you need remote access to your services.
#
# THREE OPTIONS:
# 1. Tailscale (EASIEST for end users - just install app & sign in)
# 2. Cloudflare Tunnel (WEB ONLY - users just click a link, no app needed)
# 3. WireGuard (ADVANCED - full control but requires manual config distribution)
#
# Recommended: Use Tailscale for ease of use

# Option 1: Tailscale (Recommended - Easiest for End Users)
# ================================================================
# Get auth key from: https://login.tailscale.com/admin/settings/keys
TAILSCALE_AUTH_KEY=  # tskey-auth-xxxxxxxxx (get from Tailscale admin)
TAILSCALE_HOSTNAME=rpi-dns-stack  # Hostname for your device in Tailscale network
TAILSCALE_ROUTES=192.168.8.0/24  # Subnet routes to advertise
# Enable: docker compose --profile tailscale up -d

# Option 2: Cloudflare Tunnel (For Web Services Only)
# ================================================================
# Requires: Domain name pointed to Cloudflare
# Get token from: Cloudflare Dashboard → Zero Trust → Access → Tunnels
CLOUDFLARE_TUNNEL_TOKEN=  # Get from Cloudflare Tunnel creation
# Enable: docker compose --profile cloudflare up -d

# Option 3: WireGuard VPN (Advanced Users Only)
# ================================================================
WG_SERVER_URL=auto  # Set to your public IP or DDNS hostname (e.g., home.example.com)
WG_SERVER_PORT=51820  # WireGuard port (default: 51820)
WG_PEERS=3  # Number of peer/client configurations to generate
WG_PEER_DNS=192.168.8.251  # DNS server for VPN clients (use Pi-hole for ad-blocking)
WG_INTERNAL_SUBNET=10.13.13.0  # Internal VPN subnet
WG_ALLOWED_IPS=0.0.0.0/0  # Split tunnel: 192.168.8.0/24 (local only) or 0.0.0.0/0 (all traffic)
WG_LOG_CONFS=true  # Log peer configurations

# WireGuard-UI Management Interface
WGUI_USERNAME=admin  # Username for WireGuard-UI
# SECURITY: Generate a strong random password with: openssl rand -base64 32
WGUI_PASSWORD=  # Password for WireGuard-UI (only needed if using WireGuard)
WGUI_SESSION_SECRET=  # Session secret for WireGuard-UI (only needed if using WireGuard)
WGUI_MTU=1420  # MTU for WireGuard interface (lower if experiencing issues)
WGUI_PERSISTENT_KEEPALIVE=25  # Keep-alive interval in seconds
WGUI_FORWARD_MARK=0xca6c  # Firewall mark for packet forwarding
# Enable: docker compose --profile wireguard up -d

# Optional: Email Notifications (for WireGuard only)
SENDGRID_API_KEY=  # SendGrid API key for email notifications
EMAIL_FROM=wireguard@yourdomain.com  # From email address
EMAIL_FROM_NAME=WireGuard VPN  # From name for emails

# ================================================================
# SSO Configuration (OPTIONAL - Single Sign-On for all services)
# ================================================================
# The stack works perfectly WITHOUT SSO! Only configure if you want
# centralized authentication with 2FA for all services.
#
# SSO provides:
# - Single login for Pi-hole, Grafana, WireGuard-UI, etc.
# - Two-Factor Authentication (TOTP, WebAuthn)
# - Centralized user management
# - Session control and security policies
#
# To enable: Uncomment and configure the variables below, then run:
#   cd stacks/sso && bash generate-secrets.sh
#   docker compose -f stacks/sso/docker-compose.yml up -d

# OAuth2 Configuration (generated by generate-secrets.sh)
SSO_ENABLED=false  # Set to true to enable SSO authentication
OAUTH2_COOKIE_SECRET=  # Cookie secret for OAuth2 Proxy
OAUTH2_CLIENT_ID=authelia  # OAuth2 client ID
OAUTH2_CLIENT_SECRET=  # OAuth2 client secret

# OAuth2 Client Secrets for Services (generated by generate-secrets.sh)
GRAFANA_OAUTH_CLIENT_SECRET=  # Grafana OAuth client secret
PIHOLE_OAUTH_CLIENT_SECRET=  # Pi-hole OAuth client secret
WIREGUARD_OAUTH_CLIENT_SECRET=  # WireGuard-UI OAuth client secret

# SSO Admin User
SSO_ADMIN_EMAIL=admin@rpi-dns-stack.local  # Admin user email
SSO_ADMIN_DISPLAYNAME=Admin User  # Admin user display name

# ================================================================
# Single Pane of Glass (SPoG) Configuration (OPTIONAL)
# ================================================================
# The stack works perfectly in standalone mode! Only configure if you want
# centralized observability on a Dell CoreSrv or other central server.
#
# SPoG Architecture:
# - Dell CoreSrv hosts: Traefik, Authelia, Loki, Prometheus, Grafana
# - Pi DNS node ships logs to Dell via Promtail agent
# - NetSec Pi ships logs to Dell via Promtail agent
# - All services accessible via https://*.local through Traefik
#
# To enable SPoG mode:
#   1. Deploy observability stack on Dell CoreSrv
#   2. Configure firewall to allow Pis -> Dell port 3100
#   3. Deploy Promtail agents on Pis (see stacks/agents/pi-dns/)
#   4. Configure Traefik reverse proxy on Dell
#
# See: docs/SPOG_INTEGRATION_GUIDE.md for complete setup

# SPoG Mode Configuration
SPOG_ENABLED=false  # Set to true to enable SPoG mode
SPOG_MODE=standalone  # Options: standalone, spog

# Dell CoreSrv Configuration (when SPOG_ENABLED=true)
DELL_CORESRV_IP=192.168.8.100  # IP address of Dell CoreSrv
# Loki endpoint for Promtail log shipping (include full path /loki/api/v1/push)
LOKI_URL=http://192.168.8.100:3100/loki/api/v1/push

# Observability Endpoints (for SPoG mode)
PROMETHEUS_ENDPOINT=http://192.168.8.100:9090  # Prometheus on Dell
GRAFANA_ENDPOINT=https://grafana.local  # Grafana via Traefik on Dell

# Node Exporter (for metrics collection)
NODE_EXPORTER_ENABLED=true  # Enable Node Exporter for Prometheus scraping
NODE_EXPORTER_PORT=9100  # Port for Node Exporter metrics

# ================================================================
# Smart DNS / Unbound Prefetch Configuration
# ================================================================
# Enable smarter DNS with prefetching and enhanced caching.
# This improves DNS performance by:
# - Prefetching popular records before they expire
# - Larger cache sizes for better hit rates (448MB max)
# - QNAME minimisation for enhanced privacy
# - Aggressive NSEC for reduced queries
# Set to 1 to enable, 0 to disable (default: 0)
UNBOUND_SMART_PREFETCH=0

# ================================================================
# Encrypted DNS Gateway (DoH/DoT) Configuration
# ================================================================
# Enable DoH/DoT terminator for "dumb" devices (TVs, consoles, IoT).
# This gateway accepts encrypted DNS queries and forwards them to
# the internal Pi-hole/Unbound VIP, keeping all filtering rules intact.
#
# Before enabling:
# 1. Generate TLS certificates: cd stacks/dns/blocky && bash generate-certs.sh
# 2. Set ORION_DOH_DOT_GATEWAY_ENABLED=1
# 3. Deploy with: docker compose --profile doh-dot-gateway up -d
#
# Client configuration:
# - DoH URL: https://<your-ip>/dns-query
# - DoT server: <your-ip>:853
#
# Set to 1 to enable, 0 to disable (default: 0)
ORION_DOH_DOT_GATEWAY_ENABLED=0