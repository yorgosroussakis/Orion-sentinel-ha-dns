# Single Pi HA Mode - All services on one host with redundancy
# Deploy with: docker compose --profile single-pi-ha --profile pi1 up -d

#####################################
# DEPLOYMENT MODE
#####################################
# This file is for: Mode A - single-pi-ha
# Description: All DNS services (primary + secondary) run on a single Raspberry Pi
# Use case: High availability on one host with failover between services

#####################################
# HOST CONFIGURATION
#####################################
# Hostname for this Pi
PI1_HOSTNAME=pi1-dns

#####################################
# NETWORK CONFIGURATION
#####################################
# Physical network interface (usually eth0)
NETWORK_INTERFACE=eth0

# Network subnet
SUBNET=192.168.8.0/24

# Network gateway
GATEWAY=192.168.8.1

# Virtual IP for DNS service (accessed by clients)
# This is the IP that clients will use for DNS queries
VIP_ADDRESS=192.168.8.249

#####################################
# KEEPALIVED CONFIGURATION
#####################################
# Enable Keepalived for VIP management
KEEPALIVED_ENABLED=true

# Keepalived priority (100 for single-pi mode)
KEEPALIVED_PRIORITY=100

# Virtual Router ID (must be unique on your network)
VIRTUAL_ROUTER_ID=51

# VRRP Authentication Password
# SECURITY: Generate with: openssl rand -base64 20
VRRP_PASSWORD=CHANGE_ME_REQUIRED

#####################################
# PI-HOLE CONFIGURATION
#####################################
# Pi-hole admin password
# SECURITY: Generate with: openssl rand -base64 32
PIHOLE_PASSWORD=CHANGE_ME_REQUIRED

# Timezone
TZ=Europe/London

#####################################
# DNS CONFIGURATION
#####################################
# Upstream DNS servers (Unbound services by name)
# Primary Pi-hole uses primary Unbound
PIHOLE_DNS_PRIMARY=unbound_primary#5335
# Secondary Pi-hole uses secondary Unbound
PIHOLE_DNS_SECONDARY=unbound_secondary#5335

#####################################
# MONITORING & OBSERVABILITY (Optional)
#####################################
# Grafana admin password
# SECURITY: Generate with: openssl rand -base64 32
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_REQUIRED

# Prometheus retention period
PROMETHEUS_RETENTION=30d

#####################################
# SIGNAL NOTIFICATIONS (Optional)
#####################################
# Your phone number registered with Signal (with country code)
SIGNAL_NUMBER=+1234567890

# Recipient phone numbers (comma-separated)
SIGNAL_RECIPIENTS=+1234567890

#####################################
# DOCKER RESOURCE LIMITS
#####################################
# Pi-hole container limits
PIHOLE_CPU_LIMIT=1.0
PIHOLE_MEM_LIMIT=512M

# Unbound container limits
UNBOUND_CPU_LIMIT=0.5
UNBOUND_MEM_LIMIT=256M

# Keepalived container limits
KEEPALIVED_CPU_LIMIT=0.25
KEEPALIVED_MEM_LIMIT=128M

#####################################
# ADVANCED SETTINGS
#####################################
# Sync interval in seconds (for Pi-hole config sync between primary/secondary)
SYNC_INTERVAL=300

# DNS query logging
ENABLE_QUERY_LOGGING=true

# DNSSEC validation
ENABLE_DNSSEC=true

#####################################
# SMART DNS / UNBOUND PREFETCH
#####################################
# Enable smarter DNS with prefetching and enhanced caching
# This improves DNS performance by:
# - Prefetching popular records before they expire
# - Larger cache sizes for better hit rates
# - QNAME minimisation for enhanced privacy
# - Aggressive NSEC for reduced queries
# Set to 1 to enable, 0 to disable (default: 0)
UNBOUND_SMART_PREFETCH=0

#####################################
# ENCRYPTED DNS GATEWAY (DoH/DoT)
#####################################
# Enable DoH/DoT terminator for "dumb" devices (TVs, consoles, IoT).
# This gateway accepts encrypted DNS queries and forwards them to
# the internal Pi-hole/Unbound VIP, keeping all filtering rules intact.
#
# Before enabling:
# 1. Generate TLS certs: cd stacks/dns/blocky && bash generate-certs.sh
# 2. Set ORION_DOH_DOT_GATEWAY_ENABLED=1
# 3. Deploy with: docker compose --profile doh-dot-gateway up -d
#
# Set to 1 to enable, 0 to disable (default: 0)
ORION_DOH_DOT_GATEWAY_ENABLED=0
