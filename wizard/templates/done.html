<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Complete - Orion DNS HA</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üåê Orion Sentinel DNS HA</h1>
            <p class="subtitle">Setup Complete!</p>
        </header>

        <main>
            <div class="progress-bar">
                <div class="progress-step completed">1. Network</div>
                <div class="progress-step completed">2. Profile</div>
                <div class="progress-step completed">3. Done</div>
            </div>

            <div class="card success-card">
                <div class="success-icon">‚úì</div>
                <h2>You're All Set!</h2>
                <p class="intro">
                    Your Orion DNS HA configuration has been saved.
                    {% if already_setup %}
                    The setup was already completed previously.
                    {% endif %}
                </p>

                <div class="next-steps">
                    <h3>Next Steps:</h3>
                    
                    <div class="step-box">
                        <h4>1. Deploy the Stack</h4>
                        <p>Run this command on your Raspberry Pi to start all services:</p>
                        <div class="code-block">
                            <code>cd /path/to/Orion-sentinel-ha-dns</code><br>
                            <code>docker compose -f stacks/dns/docker-compose.yml up -d</code>
                        </div>
                    </div>

                    <div class="step-box">
                        <h4>2. Configure Your Router</h4>
                        <p>Set your router's DNS server to:</p>
                        <div class="highlight-box">
                            <strong>{{ dns_ip }}</strong>
                        </div>
                        <p class="help-text">
                            This is usually found in your router's DHCP or LAN settings.
                            After saving, your entire network will use Orion DNS HA.
                        </p>
                    </div>

                    <div class="step-box">
                        <h4>3. Access Pi-hole Admin Interface</h4>
                        <p>Manage your DNS blocking and view statistics at:</p>
                        <div class="link-box">
                            <a href="http://{{ pihole_ip }}/admin" target="_blank">
                                http://{{ pihole_ip }}/admin
                            </a>
                        </div>
                        <p class="help-text">
                            Log in with the password you set during setup.
                        </p>
                    </div>

                    <div class="step-box">
                        <h4>4. Apply Your DNS Profile (Optional)</h4>
                        <p>After the stack is running, apply your selected DNS profile:</p>
                        <div class="code-block">
                            <code>python3 scripts/apply-profile.py --profile standard</code>
                        </div>
                        <p class="help-text">
                            Replace "standard" with your chosen profile (family or paranoid).
                        </p>
                    </div>
                </div>

                <div class="info-box">
                    <h3>Additional Resources</h3>
                    <ul>
                        <li>üìñ <a href="https://github.com/yorgosroussakis/Orion-sentinel-ha-dns" target="_blank">Full Documentation on GitHub</a></li>
                        <li>üîß <a href="https://github.com/yorgosroussakis/Orion-sentinel-ha-dns/blob/main/TROUBLESHOOTING.md" target="_blank">Troubleshooting Guide</a></li>
                        <li>‚öôÔ∏è <a href="https://github.com/yorgosroussakis/Orion-sentinel-ha-dns/blob/main/docs/operations.md" target="_blank">Operations & Maintenance</a></li>
                    </ul>
                </div>

                {% if already_setup %}
                <div class="reapply-section">
                    <h3>Change DNS Profile</h3>
                    <p>Want to apply a different security profile?</p>
                    <form id="reapplyForm">
                        <select id="profile-select" name="profile">
                            <option value="standard">Standard - Balanced blocking</option>
                            <option value="family">Family - Safe for children</option>
                            <option value="paranoid">Paranoid - Maximum privacy</option>
                        </select>
                        <button type="submit" class="btn btn-primary">Apply Profile</button>
                    </form>
                    <div id="reapply-message" style="display: none; margin-top: 10px;"></div>
                </div>
                {% endif %}
            </div>
        </main>

        <footer class="wizard-footer">
            <p>Thank you for using <strong>Orion Sentinel DNS HA</strong></p>
        </footer>
    </div>

    {% if already_setup %}
    <script>
        document.getElementById('reapplyForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const profile = document.getElementById('profile-select').value;
            const messageDiv = document.getElementById('reapply-message');
            
            try {
                const response = await fetch('/api/reapply-profile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ profile: profile })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    messageDiv.className = 'success-message';
                    messageDiv.textContent = result.message || 'Profile updated successfully!';
                } else {
                    messageDiv.className = 'error-message';
                    messageDiv.textContent = result.error || 'Failed to update profile';
                }
                messageDiv.style.display = 'block';
            } catch (error) {
                messageDiv.className = 'error-message';
                messageDiv.textContent = 'Error: ' + error.message;
                messageDiv.style.display = 'block';
            }
        });
    </script>
    {% endif %}
</body>
</html>
