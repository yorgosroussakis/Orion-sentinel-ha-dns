# =============================================================================
# Orion Sentinel DNS HA - Primary Node Environment Configuration
# =============================================================================
#
# This file contains environment variables for the PRIMARY (MASTER) node
# in a two-node high-availability DNS setup.
#
# Node Configuration:
#   - Node A (Primary)
#   - IP Address: 192.168.8.249
#   - Role: MASTER
#   - Priority: 200 (higher priority = preferred MASTER)
#   - VIP: 192.168.8.250/24 on eth1
#
# Copy this file to .env on your PRIMARY node and adjust values as needed.
#
# =============================================================================

# Node Identity
# =============================================================================
HOSTNAME=orion-dns-primary
NODE_IP=192.168.8.249
NODE_ROLE=MASTER

# Network Configuration
# =============================================================================
# Virtual IP (VIP) - This IP floats between primary and secondary nodes
VIP_ADDRESS=192.168.8.250
VIP_NETMASK=24

# Network interface where the VIP will be assigned
NETWORK_INTERFACE=eth1

# Network settings
SUBNET=192.168.8.0/24
GATEWAY=192.168.8.1

# Timezone
TZ=UTC

# Keepalived Configuration
# =============================================================================
KEEPALIVED_PRIORITY=200
VIRTUAL_ROUTER_ID=51
ROUTER_ID=orion-dns-ha

# VRRP Authentication Password
# SECURITY: Generate a strong random password (must match on both nodes)
# Example: openssl rand -base64 20
VRRP_PASSWORD=CHANGE_ME_TO_SECURE_PASSWORD_123!

# Unicast VRRP Configuration (recommended for most setups)
USE_UNICAST_VRRP=true

# Peer node IP address (Node B / Secondary)
PEER_IP=192.168.8.243

# Source IP for unicast VRRP (usually same as NODE_IP)
UNICAST_SRC_IP=192.168.8.249

# Health Check Configuration
# =============================================================================
CHECK_DNS_TARGET=127.0.0.1
CHECK_DNS_FQDN=github.com
CHECK_INTERVAL=5
CHECK_TIMEOUT=3
CHECK_WEIGHT=-20
CHECK_FALL=2
CHECK_RISE=2

# Pi-hole Configuration
# =============================================================================
# Web admin password
# SECURITY: Generate a strong random password
# Example: openssl rand -base64 32
WEBPASSWORD=CHANGE_ME_TO_SECURE_PASSWORD_123!

# Pi-hole API password (can be same as WEBPASSWORD)
FTLCONF_webserver_api_password=${WEBPASSWORD}

# DNS Upstream Configuration
# Uses local Unbound on port 5335 for maximum privacy
FTLCONF_dns_upstreams=127.0.0.1#5335

# DNSSEC validation
FTLCONF_dns_dnssec=true

# Local IPv4 address
FTLCONF_local_ipv4=${NODE_IP}

# DNS listening mode (all = listen on all interfaces)
DNSMASQ_LISTENING=all

# Reverse DNS Configuration
REV_SERVER=true
REV_SERVER_TARGET=192.168.8.1
REV_SERVER_DOMAIN=lan
REV_SERVER_CIDR=192.168.8.0/24

# Domain Name
DOMAIN_NAME=lan

# Unbound Configuration
# =============================================================================
# DNS over TLS (DoT) Configuration
# By default, Unbound performs fully local recursive DNS resolution
# If you want DoT forwarding to NextDNS, configure in unbound/nextdns-forward.conf
UNBOUND_FORWARD_TLS=
UNBOUND_FORWARD_ZONES=

# Optional: Redis caching (if supported by image)
REDIS_ENABLE=false
REDIS_SERVER=redis:6379
REDIS_PASSWORD=

# Prometheus Pushgateway Integration (Optional)
# =============================================================================
# Leave empty to disable metrics pushing
PROM_PUSHGATEWAY_URL=
PROM_JOB_NAME=orion_dns_ha
PROM_INSTANCE_LABEL=node-primary

# Monitoring Exporters (Optional)
# =============================================================================
# Loki URL for log shipping (used by Promtail)
# Include full path /loki/api/v1/push in the URL
# Point to your Loki instance or CoreServices stack
LOKI_URL=http://192.168.8.100:3100/loki/api/v1/push

# Operational Settings
# =============================================================================
# Backup retention in days
BACKUP_RETENTION_DAYS=7

# Repository directory on host
REPO_DIR=/opt/orion-dns-ha

# Container names
PIHOLE_CONTAINER_NAME=pihole_unbound
KEEPALIVED_CONTAINER_NAME=keepalived

# Health check settings
HEALTH_FAIL_THRESHOLD=2
