# Example environment configuration for Multi-Node HA Setup

#####################################
# NODE CONFIGURATION
#####################################
# Set this to identify which node this is
# Options: "primary" or "secondary"
NODE_ROLE=primary

# IP address of THIS node
NODE_IP=192.168.8.11

# IP address of the PEER node
PEER_IP=192.168.8.12

#####################################
# NETWORK CONFIGURATION
#####################################
# Physical network interface (usually eth0)
NETWORK_INTERFACE=eth0

# Network subnet
SUBNET=192.168.8.0/24

# Network gateway
GATEWAY=192.168.8.1

# Virtual IP (VIP) for high availability
# This IP will float between nodes
VIP_ADDRESS=192.168.8.255

#####################################
# DNS SERVICE IP ADDRESSES
#####################################
# Pi-hole Primary (runs on Node #1)
PRIMARY_DNS_IP=192.168.8.251

# Pi-hole Secondary (runs on Node #2)
SECONDARY_DNS_IP=192.168.8.252

# Unbound Primary (runs on Node #1)
UNBOUND_PRIMARY_IP=192.168.8.253

# Unbound Secondary (runs on Node #2)
UNBOUND_SECONDARY_IP=192.168.8.254

#####################################
# KEEPALIVED CONFIGURATION
#####################################
# Keepalived priority (higher = more likely to be MASTER)
# Primary node: 100
# Secondary node: 90
KEEPALIVED_PRIORITY=100

# Virtual Router ID (must be same on both nodes)
VIRTUAL_ROUTER_ID=51

# VRRP Authentication Password
VRRP_PASSWORD=SecureVRRPPassword123!

# Use unicast VRRP instead of multicast (recommended)
USE_UNICAST_VRRP=true

#####################################
# PI-HOLE CONFIGURATION
#####################################
# Pi-hole admin password (same on both nodes)
PIHOLE_PASSWORD=ChangeThisSecurePassword123!

# Timezone
TZ=Europe/London

#####################################
# NEXTDNS FALLBACK CONFIGURATION
#####################################
# NextDNS fallback allows Pi-hole to fall back to NextDNS when Unbound
# fails or times out. This provides an external DNS safety net.
#
# DNS Resolution Chain (when enabled):
#   Clients → VIP (Pi-hole) → Unbound (primary) → NextDNS (fallback)
#
# To enable fallback:
#   - Set NEXTDNS_DNS_IPV4 to your NextDNS profile endpoint
#   - Pi-hole uses Unbound as primary upstream
#   - Pi-hole uses NextDNS as secondary/fallback upstream
#   - If Unbound fails/times out, queries automatically fall back to NextDNS
#
# To disable fallback (default):
#   - Leave NEXTDNS_DNS_IPV4 empty
#   - Pi-hole uses Unbound only (no external DNS fallback)

# NextDNS IPv4 endpoint (set this to enable fallback)
# Get your profile endpoints from: https://my.nextdns.io
# Example: 45.90.28.0 (for profile ID abc123, use 45.90.28.abc123)
NEXTDNS_DNS_IPV4=

# NextDNS IPv6 endpoint (optional, leave empty to disable IPv6 fallback)
# Example: 2a07:a8c0::ab:cd12
NEXTDNS_DNS_IPV6=

# NextDNS DNS-over-HTTPS URL (optional, for reference/DoH support if stack supports it)
# Example: https://dns.nextdns.io/abc123
NEXTDNS_DOH_URL=

#####################################
# SYNCHRONIZATION SETTINGS
#####################################
# Sync interval in seconds (for Pi-hole config sync)
SYNC_INTERVAL=3600

# Gravity Sync mode: "push" (primary to secondary) or "pull" (secondary from primary)
GRAVITY_SYNC_MODE=push

# Gravity Sync frequency (cron format)
# Default: Every hour
GRAVITY_SYNC_CRON="0 * * * *"

#####################################
# MONITORING & OBSERVABILITY
#####################################
# Deploy monitoring stack? (true/false)
# Only set to true on primary node to save resources
DEPLOY_MONITORING=true

# Grafana admin password
GRAFANA_ADMIN_PASSWORD=ChangeThisGrafanaPassword!

# Prometheus retention period
PROMETHEUS_RETENTION=30d

#####################################
# SIGNAL NOTIFICATIONS (Optional)
#####################################
# Your phone number registered with Signal
SIGNAL_NUMBER=+1234567890

# Recipient phone numbers (comma-separated)
SIGNAL_RECIPIENTS=+1234567890

# Enable notifications for:
NOTIFY_ON_FAILOVER=true
NOTIFY_ON_FAILBACK=true
NOTIFY_ON_SYNC_FAILURE=true
NOTIFY_ON_SERVICE_DOWN=true

#####################################
# AI-WATCHDOG (Optional)
#####################################
# Deploy AI-Watchdog? (only on primary node)
DEPLOY_AI_WATCHDOG=true

# Watchdog check interval in seconds
WATCHDOG_CHECK_INTERVAL=30

# Number of failures before restart
WATCHDOG_RESTART_THRESHOLD=3

# Alert cooldown period in seconds
WATCHDOG_ALERT_COOLDOWN=300

#####################################
# BACKUP CONFIGURATION
#####################################
# Backup retention in days
BACKUP_RETENTION_DAYS=30

# Backup location
BACKUP_PATH=/opt/dns-backups

# Enable automatic backups
AUTO_BACKUP_ENABLED=true

# Backup schedule (cron format) - Daily at 2 AM
BACKUP_CRON="0 2 * * *"

#####################################
# ADVANCED SETTINGS
#####################################
# DNS query logging
ENABLE_QUERY_LOGGING=true

# DNSSEC validation
ENABLE_DNSSEC=true

# DNS-over-HTTPS (DoH) - via Cloudflared
ENABLE_DOH=false

# Rate limiting (queries per second per client)
DNS_RATE_LIMIT=100

# Cache size (MB)
DNS_CACHE_SIZE=256

#####################################
# DOCKER RESOURCE LIMITS
#####################################
# Pi-hole container limits
PIHOLE_CPU_LIMIT=1.0
PIHOLE_MEM_LIMIT=512M

# Unbound container limits
UNBOUND_CPU_LIMIT=0.5
UNBOUND_MEM_LIMIT=256M

# Keepalived container limits
KEEPALIVED_CPU_LIMIT=0.25
KEEPALIVED_MEM_LIMIT=128M

# Automation Configuration
UPDATE_INTERVAL=86400                # Blocklist update interval (24 hours)
BACKUP_INTERVAL=86400                # Backup interval (24 hours)
RETENTION_DAYS=30                    # Backup retention (30 days)
SYNC_INTERVAL=300                    # Config sync interval (5 minutes)
HEALTH_CHECK_INTERVAL=60             # Health check interval (60 seconds)
MAX_RESTART_ATTEMPTS=3               # Max auto-restart attempts
RESTART_COOLDOWN=300                 # Cooldown between restarts (5 minutes)
TEST_DOMAIN=google.com               # Domain for DNS tests
DISK_USAGE_THRESHOLD=85              # Disk cleanup threshold (85%)
MEMORY_USAGE_THRESHOLD=90            # Memory restart threshold (90%)
LOG_MAX_SIZE_MB=100                  # Log rotation threshold (100MB)
BACKUP_DIR=/backup                   # Backup directory
ALERT_WEBHOOK=                       # Optional webhook for alerts
