# CodeQL Analysis for Orion Sentinel HA DNS
#
# This repository contains:
# - Shell scripts (Bash)
# - Dockerfiles
# - YAML configuration
# - Makefile
#
# CodeQL supports: Python, JavaScript/TypeScript, Go, Java, C/C++, C#, Ruby, Swift, Kotlin
# None of these languages are present in this repository.
#
# This workflow is configured to skip Python analysis (no Python code exists)
# and only run if CodeQL-supported languages are detected.

name: "CodeQL"

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]
  schedule:
    - cron: '0 0 * * 0'

jobs:
  analyze:
    name: Analyze
    runs-on: ubuntu-latest
    timeout-minutes: 360
    permissions:
      actions: read
      contents: read
      security-events: write

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Check for CodeQL-supported languages
      id: check-languages
      run: |
        echo "Checking for CodeQL-supported languages..."
        
        # Count files for each supported language
        PYTHON_FILES=$(find . -name "*.py" -type f 2>/dev/null | wc -l)
        JS_FILES=$(find . \( -name "*.js" -o -name "*.ts" -o -name "*.jsx" -o -name "*.tsx" \) -type f 2>/dev/null | wc -l)
        GO_FILES=$(find . -name "*.go" -type f 2>/dev/null | wc -l)
        JAVA_FILES=$(find . -name "*.java" -type f 2>/dev/null | wc -l)
        CPP_FILES=$(find . \( -name "*.cpp" -o -name "*.c" -o -name "*.h" -o -name "*.hpp" \) -type f 2>/dev/null | wc -l)
        CSHARP_FILES=$(find . -name "*.cs" -type f 2>/dev/null | wc -l)
        RUBY_FILES=$(find . -name "*.rb" -type f 2>/dev/null | wc -l)
        
        echo "Python files: $PYTHON_FILES"
        echo "JavaScript/TypeScript files: $JS_FILES"
        echo "Go files: $GO_FILES"
        echo "Java files: $JAVA_FILES"
        echo "C/C++ files: $CPP_FILES"
        echo "C# files: $CSHARP_FILES"
        echo "Ruby files: $RUBY_FILES"
        
        TOTAL=$((PYTHON_FILES + JS_FILES + GO_FILES + JAVA_FILES + CPP_FILES + CSHARP_FILES + RUBY_FILES))
        
        if [ "$TOTAL" -eq 0 ]; then
          echo "No CodeQL-supported languages found in repository"
          echo "has_supported_languages=false" >> $GITHUB_OUTPUT
        else
          echo "Found $TOTAL files in CodeQL-supported languages"
          echo "has_supported_languages=true" >> $GITHUB_OUTPUT
        fi

    - name: Skip CodeQL - No supported languages
      if: steps.check-languages.outputs.has_supported_languages == 'false'
      run: |
        echo "âœ… Skipping CodeQL analysis - no supported languages in repository"
        echo ""
        echo "This repository contains only:"
        echo "  - Shell scripts (Bash)"
        echo "  - Dockerfiles"  
        echo "  - YAML configuration"
        echo "  - Makefile"
        echo ""
        echo "These are analyzed by ShellCheck and yamllint in the CI workflow."
