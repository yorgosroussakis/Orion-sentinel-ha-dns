# Orion Sentinel NetSec - Promtail Configuration
# Ships Suricata logs and system metrics to Loki

server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /tmp/positions.yaml

clients:
  - url: ${LOKI_URL}

scrape_configs:
  # Suricata EVE JSON logs (primary format for alerts/flows)
  - job_name: suricata
    static_configs:
      - targets:
          - localhost
        labels:
          job: suricata
          host: ${HOSTNAME}
          stack: netsec
          component: ids
          __path__: /var/log/suricata/eve.json
    pipeline_stages:
      - json:
          expressions:
            event_type: event_type
            timestamp: timestamp
            src_ip: src_ip
            dest_ip: dest_ip
            alert_signature: alert.signature
            alert_severity: alert.severity
      - labels:
          event_type:
          alert_severity:

  # Suricata fast.log (human-readable alerts)
  - job_name: suricata-fast
    static_configs:
      - targets:
          - localhost
        labels:
          job: suricata-fast
          host: ${HOSTNAME}
          stack: netsec
          component: ids
          __path__: /var/log/suricata/fast.log

  # Suricata stats.log (performance metrics)
  - job_name: suricata-stats
    static_configs:
      - targets:
          - localhost
        labels:
          job: suricata-stats
          host: ${HOSTNAME}
          stack: netsec
          component: ids
          __path__: /var/log/suricata/stats.log

  # Suricata main log (startup/errors)
  - job_name: suricata-main
    static_configs:
      - targets:
          - localhost
        labels:
          job: suricata-main
          host: ${HOSTNAME}
          stack: netsec
          component: ids
          __path__: /var/log/suricata/suricata.log

  # System logs
  - job_name: syslog
    static_configs:
      - targets:
          - localhost
        labels:
          job: syslog
          host: ${HOSTNAME}
          stack: netsec
          __path__: /var/log/syslog

  # Docker container logs
  - job_name: docker
    static_configs:
      - targets:
          - localhost
        labels:
          job: docker
          host: ${HOSTNAME}
          stack: netsec
          __path__: /var/lib/docker/containers/*/*-json.log
